# 电梯振动数据分析软件 - 项目技术总结

## 项目概述

本项目开发了一款电梯振动数据分析软件，旨在提供高效、直观的电梯振动数据处理和分析功能。该软件支持CSV数据导入、时域和频域分析、多轴数据展示以及全域FFT分析等核心功能，为电梯维护和故障诊断提供有力的数据支持。

## 技术栈

- **编程语言**: Python 3.14
- **核心库**:
  - pandas: 数据处理和分析
  - numpy: 数值计算
  - matplotlib: 数据可视化
  - scipy: 科学计算(FFT分析、积分等)
  - tkinter: 图形用户界面
- **打包工具**: PyInstaller

## 功能特点

### 1. 数据导入与处理

- 支持CSV格式的电梯振动数据导入
- 自动数据预处理：去除均值、标准化处理
- 数据验证和错误处理机制

### 2. 振动分析功能

- **交互式FFT分析**: 提供可交互的频谱分析界面
- **单轴FFT分析**: 支持对x/y/z单个轴进行独立分析
- **组合数据显示**: 同时展示加速度、速度和位移数据
- **全域FFT分析**: 新增功能，提供完整的多轴频谱对比分析

### 3. 用户界面

- 直观的按钮式操作界面
- 状态显示和错误提示
- 中文字体支持，确保显示正常
- 响应式设计，适应不同数据规模

## 系统架构

### 1. 核心类设计

- **ElevatorVibrationAnalyzer**:
  - 封装数据处理和计算逻辑
  - 提供速度和位移计算功能
  - 支持多种数据分析方法

### 2. 功能模块

- **数据导入模块**: 负责文件选择和数据加载
- **分析计算模块**: 执行FFT变换、积分等核心算法
- **可视化模块**: 生成各类图表和交互界面
- **用户界面模块**: 提供操作入口和状态反馈

## 开发过程

### 1. 功能迭代

- **初始版本**: 基础数据加载和简单分析
- **版本2**: 增加交互式FFT和单轴分析功能
- **版本3**: 添加组合数据显示功能
- **最新版本**: 实现全域FFT图分析功能，优化UI显示

### 2. 关键技术点

- **FFT分析实现**:
  - 使用scipy.fft进行快速傅里叶变换
  - 单边频谱处理和幅度校正
  - 频率轴正确映射

- **速度位移计算**:
  - 通过数值积分将加速度转换为速度和位移
  - 去除积分漂移问题
  - 保持数据准确性和稳定性

- **UI优化**:
  - 动态按钮状态管理
  - 窗口尺寸自适应
  - 清晰的视觉层次结构

## 项目结构

```
震动数据 VER4/
├── elevator_vibration_analysis_gui.py  # 主GUI程序
├── elevator_vibration_analysis.py      # 核心分析模块
├── dist/                               # 打包输出目录
│   └── elevator_vibration_analysis_gui.exe  # 可执行文件
├── build/                              # 构建临时文件
└── 项目技术总结.md                      # 本技术文档
```

## 数学计算方法详解

### 1. 速度曲线计算

软件使用数值积分方法将加速度数据转换为速度数据，具体实现如下：

```python
def calculate_velocity(self):
    # 使用梯形法则积分计算速度
    self.vz = integrate.cumulative_trapezoid(self.az / 100, self.time, initial=0)
    return self.vz
```

**数学原理**：
- 使用**梯形法则**（Trapezoidal Rule）进行数值积分
- 梯形法则通过将相邻数据点连接成梯形并计算面积，近似求解积分值
- 对加速度数据（az）进行除以100的操作，这是单位转换步骤（从cm/s²转换为m/s²）
- 参数`initial=0`确保积分从速度为零开始
- 时间步长使用真实时间值（self.time），保证积分精度

### 2. 位移曲线计算

位移计算同样采用数值积分方法，但积分对象变为速度数据：

```python
def calculate_displacement(self):
    # 使用梯形法则积分计算位移
    self.sz = integrate.cumulative_trapezoid(self.vz, self.time, initial=0)
    return self.sz
```

**数学原理**：
- 基于速度积分计算位移，应用**两次连续积分**（加速度→速度→位移）
- 同样使用梯形法则确保计算稳定性和准确性
- 时间步长与速度计算保持一致，保证单位正确性
- 位移计算前先检查速度数据是否存在，确保数据完整性

### 3. FFT频谱分析计算

软件实现了两种FFT分析方法，一种用于特定时间段的分析，另一种用于全域分析。以下是全域FFT的核心实现：

```python
def perform_full_fft(data):
    # 执行FFT
    fft_result = np.fft.fft(data)
    # 计算幅度
    magnitude = np.abs(fft_result / n)
    # 单边频谱处理
    magnitude = magnitude[:n//2]
    if len(magnitude) > 2:
        magnitude[1:-1] = 2 * magnitude[1:-1]
    elif len(magnitude) == 2:
        magnitude[1] = 2 * magnitude[1]
    return magnitude
```

**数学原理**：

1. **快速傅里叶变换**：
   - 使用NumPy的`np.fft.fft`函数执行标准FFT算法
   - FFT将时域信号转换为频域表示，揭示信号中的频率成分

2. **幅度计算与归一化**：
   - 计算复数FFT结果的模值：`np.abs(fft_result)`
   - 除以数据点数量`n`进行归一化，确保幅度值与原始信号能量一致

3. **单边频谱处理**：
   - 由于实信号的FFT结果具有共轭对称性，只保留前半部分（0到采样频率的一半）
   - 对中间频率点（不包括直流分量和Nyquist频率）乘以2，补偿能量损失
   - 这一处理匹配MATLAB等工具的FFT实现方式

4. **频率轴计算**：
   - 在全域FFT中使用`np.linspace(0, sampling_rate/2, n//2)`创建频率轴
   - 频率范围覆盖0到Nyquist频率（采样率的一半）

5. **频率过滤**：
   - 在标准FFT函数中实现了1-200Hz的频率过滤：`mask = (freq >= 1) & (freq <= 200)`
   - 这一范围针对电梯振动特性进行了优化

### 4. 全域FFT图功能详解

全域FFT图是软件的核心功能之一，它提供了电梯振动数据的全面频谱分析视图：

#### 主要特性

1. **多轴频谱对比**: 同时展示x/y/z三个轴的加速度频谱
2. **多维数据整合**: 包含速度和位移曲线，提供完整的振动信息
3. **清晰的数据表示**: 使用不同颜色区分各轴数据
4. **详细的图表布局**: 5个子图垂直排列，便于对比分析

#### 实现原理

```python
def show_global_fft():
    # 创建分析器并获取数据
    analyzer = ElevatorVibrationAnalyzer(loaded_df, sampling_rate)
    analyzer_data = analyzer.get_all_data()
    
    # 执行完整FFT分析
    # 计算频率轴
    # 绘制多轴频谱图
    # 展示速度和位移曲线
```

## 使用说明

### 1. 基本操作流程

1. 运行电梯振动数据分析软件
2. 点击「选择CSV数据文件」按钮导入振动数据
3. 根据分析需求选择相应功能按钮：
   - 交互式FFT分析
   - 单轴FFT分析
   - 显示组合数据
   - 全域FFT图（推荐）
4. 分析完成后可关闭程序

### 2. 数据要求

- 支持的CSV格式应包含ax、ay、az三个轴的加速度数据
- 采样频率默认为1600Hz
- 建议数据长度不少于1000个采样点

## 部署说明

### 1. 直接运行

- 双击`dist/elevator_vibration_analysis_gui.exe`即可启动程序
- 无需安装Python环境或额外依赖

### 2. 源码运行

```bash
# 安装依赖
pip install pandas numpy matplotlib scipy

# 运行程序
python elevator_vibration_analysis_gui.py
```

### 3. 重新打包

```bash
# 使用PyInstaller重新打包
pyinstaller --onefile --windowed elevator_vibration_analysis_gui.py
```

## 技术挑战与解决方案

1. **中文显示问题**
   - 解决方案：设置matplotlib字体参数，确保中文标签正常显示

2. **FFT分析精度**
   - 解决方案：实现单边频谱处理和幅度校正，提高频率分析准确性

3. **用户界面可见性**
   - 解决方案：优化窗口尺寸和按钮布局，增强视觉设计

4. **性能优化**
   - 解决方案：数据处理逻辑封装，避免重复计算

## 未来改进方向

1. 增加多文件对比分析功能
2. 添加振动异常检测算法
3. 实现报告自动生成功能
4. 优化大文件处理性能
5. 增加数据导出和分享功能

## 总结

电梯振动数据分析软件的开发成功实现了从数据导入、处理、分析到可视化的完整工作流。通过科学的算法设计和友好的用户界面，该软件能够帮助技术人员快速、准确地分析电梯振动数据，为电梯的安全运行和维护提供有力支持。全域FFT图功能的添加进一步提升了软件的分析能力，使其成为电梯振动分析领域的有力工具。